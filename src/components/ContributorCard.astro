---
import type { ProcessedContributor } from '../utils/processContributors';

interface Props {
  contributor: ProcessedContributor;
}

const { contributor } = Astro.props;

// Format commit date
const formatCommitDate = (date: string) => {
  return new Date(date).toLocaleDateString('en-US', {
    year: 'numeric',
    month: 'short',
    day: 'numeric'
  });
};
---

<div class="group bg-white rounded-2xl p-6 shadow-sm hover:shadow-2xl transition-all duration-300 hover:-translate-y-2 border border-gray-100/80">
  <!-- Header: Avatar + Name -->
  <div class="flex items-start gap-4 mb-4">
    <img
      src={contributor.avatarUrl}
      alt={contributor.login}
      class="w-16 h-16 rounded-full ring-2 ring-white shadow-md"
      loading="lazy"
    />
    <div class="flex-1">
      <h3 class="font-bold text-lg text-gray-900">
        {contributor.name || contributor.login}
      </h3>
      <a
        href={contributor.profileUrl}
        target="_blank"
        rel="noopener noreferrer"
        class="text-sm text-blue-600 hover:text-blue-700"
      >
        @{contributor.login}
      </a>
    </div>
  </div>

  <!-- Stats -->
  <div class="flex items-center gap-4 mb-4 text-sm">
    <span class="flex items-center gap-1 text-gray-600">
      <span class="text-lg">ğŸ“Š</span>
      <strong>{contributor.totalContributions}</strong> contributions
    </span>
    <span class="text-gray-400">Â·</span>
    <span class="flex items-center gap-1 text-gray-600">
      <strong>{contributor.repoCount}</strong> repos
    </span>
  </div>

  <!-- Bio -->
  {contributor.bio && (
    <p class="text-sm text-gray-600 mb-4 line-clamp-2">
      {contributor.bio}
    </p>
  )}

  <!-- Profile Info -->
  <div class="space-y-2 mb-4 text-sm text-gray-600">
    {contributor.company && (
      <div class="flex items-center gap-2">
        <span>ğŸ¢</span>
        <span>{contributor.company}</span>
      </div>
    )}
    {contributor.location && (
      <div class="flex items-center gap-2">
        <span>ğŸ“</span>
        <span>{contributor.location}</span>
      </div>
    )}
    {contributor.email && (
      <div class="flex items-center gap-2">
        <span>ğŸ“§</span>
        <a href={`mailto:${contributor.email}`} class="hover:text-blue-600">
          {contributor.email}
        </a>
      </div>
    )}
    {(contributor.twitterUsername || contributor.websiteUrl) && (
      <div class="flex items-center gap-3">
        {contributor.twitterUsername && (
          <a
            href={`https://twitter.com/${contributor.twitterUsername}`}
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-blue-600"
          >
            ğŸ¦ @{contributor.twitterUsername}
          </a>
        )}
        {contributor.websiteUrl && (
          <a
            href={contributor.websiteUrl}
            target="_blank"
            rel="noopener noreferrer"
            class="hover:text-blue-600"
          >
            ğŸŒ Website
          </a>
        )}
      </div>
    )}
  </div>

  <!-- Latest Activity -->
  {contributor.latestCommit && (
    <div class="pt-4 border-t border-gray-100">
      <div class="text-xs text-gray-500 mb-1">Latest commit:</div>
      <div class="text-sm text-gray-700 mb-1 line-clamp-1">
        ğŸ’¬ {contributor.latestCommit.message}
      </div>
      <div class="flex items-center gap-2 text-xs text-gray-500">
        <span>ğŸ“… {formatCommitDate(contributor.latestCommit.date)}</span>
        <span>Â·</span>
        <span>{contributor.latestCommit.repo}</span>
      </div>
    </div>
  )}

  <!-- Repositories contributed to -->
  {contributor.repositories && contributor.repositories.length > 0 && (
    <div class="pt-4 border-t border-gray-100">
      <div class="text-xs text-gray-500 mb-2">ğŸ“¦ Contributed to:</div>
      <div class="flex flex-wrap gap-1.5">
        {contributor.repositories.slice(0, 5).map((repo) => (
          <a
            href={`https://github.com/DevExpGbb/${repo}`}
            target="_blank"
            rel="noopener noreferrer"
            class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-blue-50 text-blue-700 rounded-md hover:bg-blue-100 transition-colors"
          >
            {repo}
          </a>
        ))}
        {contributor.repositories.length > 5 && (
          <span class="inline-flex items-center px-2 py-0.5 text-xs font-medium bg-gray-100 text-gray-600 rounded-md">
            +{contributor.repositories.length - 5} more
          </span>
        )}
      </div>
    </div>
  )}

  <!-- View Profile Button -->
  <a
    href={contributor.profileUrl}
    target="_blank"
    rel="noopener noreferrer"
    class="mt-4 block text-center py-2 px-4 bg-gray-50 hover:bg-blue-50 text-gray-700 hover:text-blue-600 rounded-lg transition-colors text-sm font-medium"
  >
    View GitHub profile â†’
  </a>
</div>
